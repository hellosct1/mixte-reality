!function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register beforeAFRAME was available.");i(1),AFRAME.registerComponent("outline",{schema:{thickness:{type:"number",default:.003},color:{type:"color",default:"#000"},alpha:{type:"number",default:1}},init:function(){this.effect=null},update:function(){this.setupOutlineEffect()},remove:function(){this.disableOutlineEffect()},setupOutlineEffect:function(){if(null!==this.effect)return void(this.effect.enabled=!0);var e=this.data,t=this.el,i=t.sceneEl,n=i.renderer,a=i.effect;if(void 0!==n&&void 0!==a){for(var r=new THREE.OutlineEffect(n,{defaultThickness:e.thickness,defaultColor:new THREE.Color(e.color),defaultAlpha:e.alpha}),o=Object.keys(n),l=0,s=o.length;l<s;l++){var u=o[l];void 0===r[u]&&(r[u]="function"==typeof n[u]?n[u].bind(n):n[u])}this.effect=r,i.effect=new THREE.VREffect(r)}},disableOutlineEffect:function(){null!==this.effect&&(this.effect.enabled=!1)}})},function(e,t){THREE.OutlineEffect=function(e,t){function i(){return new THREE.ShaderMaterial({name:"invisible",visible:!1})}function n(e){var t,n,a=A[e.type];e.outlineParameters;if(void 0!==a){var r=THREE.ShaderLib[a];t=r.uniforms,n=r.vertexShader}else if(!0===e.isRawShaderMaterial){if(t=e.uniforms,n=e.vertexShader,!/attribute\s+vec3\s+position\s*;/.test(n)||!/attribute\s+vec3\s+normal\s*;/.test(n))return console.warn("THREE.OutlineEffect requires both vec3 position and normal attributes in vertex shader, does not draw outline for "+e.name+"(uuid:"+e.uuid+") material."),i()}else{if(!0!==e.isShaderMaterial)return i();t=e.uniforms,n=e.vertexShader}var o=Object.assign({},t,k),l=n.replace(/void\s+main\s*\(\s*\)/,M+"\nvoid main()").replace(/\}\s*$/,R+"\n}").replace(/#include\s+<[\w_]*light[\w_]*>/g,""),s={};return/vec3\s+transformed\s*=/.test(n)||/#include\s+<begin_vertex>/.test(n)||(s.DECLARE_TRANSFORMED=!0),new THREE.ShaderMaterial({defines:s,uniforms:o,vertexShader:l,fragmentShader:T,side:THREE.BackSide,skinning:!1,morphTargets:!1,morphNormals:!1,fog:!1})}function a(e){var t=m[e.uuid];return void 0===t&&(t={material:n(e),used:!0,keepAlive:p,count:0},m[e.uuid]=t),t.used=!0,t.material}function r(e){var t=a(e);return g[t.uuid]=e,f(t,e),t}function o(e){if(void 0!==e.material){if(Array.isArray(e.material))for(var t=0,i=e.material.length;t<i;t++)e.material[t]=r(e.material[t]);else e.material=r(e.material);E[e.uuid]=e.onBeforeRender,e.onBeforeRender=s}}function l(e){if(void 0!==e.material){if(Array.isArray(e.material))for(var t=0,i=e.material.length;t<i;t++)e.material[t]=g[e.material[t].uuid];else e.material=g[e.material.uuid];e.onBeforeRender=E[e.uuid]}}function s(e,t,i,n,a,r){var o=g[a.uuid];void 0!==o&&u(a,o)}function u(e,t){var i=t.outlineParameters;e.uniforms.outlineAlpha.value=t.opacity,void 0!==i&&(void 0!==i.thickness&&(e.uniforms.outlineThickness.value=i.thickness),void 0!==i.color&&e.uniforms.outlineColor.value.copy(i.color),void 0!==i.alpha&&(e.uniforms.outlineAlpha.value=i.alpha))}function f(e,t){if("invisible"!==e.name){var i=t.outlineParameters;e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.fog=t.fog,void 0!==i?(!1===t.visible?e.visible=!1:e.visible=void 0===i.visible||i.visible,e.transparent=void 0!==i.alpha&&i.alpha<1||t.transparent,void 0!==i.keepAlive&&(m[t.uuid].keepAlive=i.keepAlive)):(e.transparent=t.transparent,e.visible=t.visible),!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1)}}function d(){var e;e=Object.keys(g);for(var t=0,i=e.length;t<i;t++)g[e[t]]=void 0;e=Object.keys(E);for(var t=0,i=e.length;t<i;t++)E[e[t]]=void 0;e=Object.keys(m);for(var t=0,i=e.length;t<i;t++){var n=e[t];!1===m[n].used?(m[n].count++,!1===m[n].keepAlive&&m[n].count>b&&delete m[n]):(m[n].used=!1,m[n].count=0)}}t=t||{},this.enabled=!0;var c=void 0!==t.defaultThickness?t.defaultThickness:.003,v=void 0!==t.defaultColor?t.defaultColor:new THREE.Color(0),h=void 0!==t.defaultAlpha?t.defaultAlpha:1,p=void 0!==t.defaultKeepAlive&&t.defaultKeepAlive,m={},b=60,g={},E={},A={MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical"},k={outlineThickness:{type:"f",value:c},outlineColor:{type:"c",value:v},outlineAlpha:{type:"f",value:h}},M=["#include <fog_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 objectNormal, vec4 skinned ) {","\tfloat thickness = outlineThickness;","\tconst float ratio = 1.0;","\tvec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + objectNormal, 1.0 );","\tvec4 norm = normalize( pos - pos2 );","\treturn pos + norm * thickness * pos.w * ratio;","}"].join("\n"),R=["#if ! defined( LAMBERT ) && ! defined( PHONG ) && ! defined( TOON ) && ! defined( PHYSICAL )","\t#ifndef USE_ENVMAP","\t\tvec3 objectNormal = normalize( normal );","\t#endif","#endif","#ifdef FLIP_SIDED","\tobjectNormal = -objectNormal;","#endif","#ifdef DECLARE_TRANSFORMED","\tvec3 transformed = vec3( position );","#endif","gl_Position = calculateOutline( gl_Position, objectNormal, vec4( transformed, 1.0 ) );","#include <fog_vertex>"].join("\n"),T=["#include <common>","#include <fog_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","\tgl_FragColor = vec4( outlineColor, outlineAlpha );","\t#include <fog_fragment>","}"].join("\n");this.render=function(t,i,n,a){if(!1===this.enabled)return void e.render(t,i,n,a);var r=e.autoClear;e.autoClear=this.autoClear,e.render(t,i,n,a);var s=t.autoUpdate,u=t.background,f=e.shadowMap.enabled;t.autoUpdate=!1,t.background=null,e.autoClear=!1,e.shadowMap.enabled=!1,t.traverse(o),e.render(t,i,n),t.traverse(l),d(),t.autoUpdate=s,t.background=u,e.autoClear=r,e.shadowMap.enabled=f},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap,this.clear=function(t,i,n){e.clear(t,i,n)},this.getPixelRatio=function(){return e.getPixelRatio()},this.setPixelRatio=function(t){e.setPixelRatio(t)},this.getSize=function(){return e.getSize()},this.setSize=function(t,i,n){e.setSize(t,i,n)},this.setViewport=function(t,i,n,a){e.setViewport(t,i,n,a)},this.setScissor=function(t,i,n,a){e.setScissor(t,i,n,a)},this.setScissorTest=function(t){e.setScissorTest(t)},this.setRenderTarget=function(t){e.setRenderTarget(t)}}}]);